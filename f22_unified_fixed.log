2025-06-19 14:02:00,454 [INFO] ================================================================================
2025-06-19 14:02:00,454 [INFO] 🚀 SERVICIO UNIFICADO F22 - REGISTRO Y CONTROL DE ACCESO
2025-06-19 14:02:00,454 [INFO] ================================================================================
2025-06-19 14:02:00,455 [INFO] 📅 Versión: 3.0.0 FIXED - 2025-06-19 14:02:00.455009
2025-06-19 14:02:00,455 [INFO] 👤 Autor: luishdz04
2025-06-19 14:02:00,455 [INFO] 🌐 Puerto WebSocket: 8082
2025-06-19 14:02:00,455 [INFO] 🏢 Dispositivo: 192.168.1.201:4370
2025-06-19 14:02:00,457 [INFO] 🌍 Zona horaria: America/Mexico_City
2025-06-19 14:02:00,458 [INFO] 
2025-06-19 14:02:00,458 [INFO] ✅ CARACTERÍSTICAS:
2025-06-19 14:02:00,458 [INFO]    📝 Registro de huellas digitales (funciones originales)
2025-06-19 14:02:00,458 [INFO]    🔐 Control de acceso en tiempo real
2025-06-19 14:02:00,458 [INFO]    📊 Validación de membresías activas
2025-06-19 14:02:00,458 [INFO]    ⏰ Restricciones de horarios
2025-06-19 14:02:00,458 [INFO]    🚪 Control automático de puertas
2025-06-19 14:02:00,458 [INFO]    💾 Registro completo en base de datos
2025-06-19 14:02:00,458 [INFO]    🔧 Deshabilitación del control interno del F22
2025-06-19 14:02:00,458 [INFO] 
2025-06-19 14:02:00,458 [INFO] ⚠️  CORRECCIONES APLICADAS:
2025-06-19 14:02:00,459 [INFO]    ✅ Control de acceso interno del F22 deshabilitado
2025-06-19 14:02:00,459 [INFO]    ✅ Monitoreo de eventos con SSR_GetRTLog
2025-06-19 14:02:00,459 [INFO]    ✅ Validación completa de membresías
2025-06-19 14:02:00,459 [INFO]    ✅ Manejo robusto de desconexiones
2025-06-19 14:02:00,459 [INFO] ================================================================================
2025-06-19 14:02:00,471 [INFO] server listening on 127.0.0.1:8082
2025-06-19 14:02:00,471 [INFO] ✅ Servidor WebSocket activo en ws://127.0.0.1:8082
2025-06-19 14:02:00,471 [INFO] ⏳ Esperando conexiones...
2025-06-19 14:02:41,453 [INFO] connection open
2025-06-19 14:02:41,454 [INFO] 🔌 [WS] Cliente conectado: 1263861882832
2025-06-19 14:02:41,455 [INFO] 🎯 [MSG] Acción recibida: connect_device
2025-06-19 14:02:41,455 [INFO] 🔌 [CONNECT] Conectando a F22 en 192.168.1.201:4370...
2025-06-19 14:02:42,427 [INFO] ✅ [ACCESS] Control de acceso del dispositivo deshabilitado (método 1)
2025-06-19 14:02:42,474 [INFO] ✅ [ACCESS] Modo verificación configurado (método 2)
2025-06-19 14:02:42,475 [INFO] ✅ [CONNECT] Conexión exitosa con F22
2025-06-19 14:02:43,503 [INFO] HTTP Request: GET https://tyuuyqypgwvdtpfvumxx.supabase.co/rest/v1/access_control_config?select=%2A&limit=1 "HTTP/1.1 200 OK"
2025-06-19 14:02:43,504 [INFO] ✅ [CONFIG] Control de acceso: HABILITADO
2025-06-19 14:02:43,504 [INFO] 🔄 [MONITOR] Iniciando control de acceso...
2025-06-19 14:02:43,591 [INFO] ✅ [MONITOR] Control de acceso activo
2025-06-19 14:02:43,591 [INFO] 🔄 [EVENTS] Thread de monitoreo iniciado
2025-06-19 14:02:43,644 [INFO] 🎯 [MSG] Acción recibida: sync_template_from_db
2025-06-19 14:02:43,645 [INFO] 🔄 [MSG] Iniciando sync_template_from_db para usuario 7265
2025-06-19 14:02:43,645 [INFO] 🔄 [SYNC] Iniciando sincronización de template desde BD...
2025-06-19 14:02:43,646 [INFO] 🔍 [SYNC] Consultando nombre para usuario UUID: 67378a76-78dc-49d9-9864-83aef6754961
2025-06-19 14:02:43,646 [INFO] 🔍 [SUPABASE] Consultando usuario: 67378a76-78dc-49d9-9864-83aef6754961
2025-06-19 14:02:43,688 [ERROR] ❌ [EVENTS] Error en monitoreo: '<win32com.gen_py.ZKEMKeeper 6.0 Control.IZKEM instance at 0x1263861884176>' object has no attribute 'SSR_GetRTLog'
2025-06-19 14:02:44,524 [INFO] HTTP Request: GET https://tyuuyqypgwvdtpfvumxx.supabase.co/rest/v1/Users?select=firstName%2ClastName&id=eq.67378a76-78dc-49d9-9864-83aef6754961 "HTTP/1.1 200 OK"
2025-06-19 14:02:44,525 [INFO] ✅ [SUPABASE] Nombre obtenido: 'MUP - Erick Francisco De Luna'
2025-06-19 14:02:44,526 [INFO] 🔄 [SYNC] === DATOS DE SINCRONIZACIÓN ===
2025-06-19 14:02:44,526 [INFO] 👤 [SYNC] Usuario: 7265 - 'MUP - Erick Francisco De Luna'
2025-06-19 14:02:44,527 [INFO] 🖐️ [SYNC] Dedo: Frontend 8 → ZKTeco 7 (Medio Izquierdo)
2025-06-19 14:02:44,527 [INFO] 👤 [SYNC] Configurando usuario en F22...
2025-06-19 14:02:44,897 [ERROR] ❌ [EVENTS] Error en monitoreo: '<win32com.gen_py.ZKEMKeeper 6.0 Control.IZKEM instance at 0x1263861884176>' object has no attribute 'SSR_GetRTLog'
2025-06-19 14:02:45,470 [INFO] ✅ [SYNC] Usuario configurado en F22: MUP - Erick Francisco De Luna
2025-06-19 14:02:45,471 [INFO] 🖐️ [SYNC] Guardando template de huella en F22...
2025-06-19 14:02:45,471 [INFO] 🔧 [SYNC] Método 1: SetUserTmpExStr...
2025-06-19 14:02:46,615 [ERROR] ❌ [EVENTS] Error en monitoreo: '<win32com.gen_py.ZKEMKeeper 6.0 Control.IZKEM instance at 0x1263861884176>' object has no attribute 'SSR_GetRTLog'
2025-06-19 14:02:46,662 [INFO] ✅ [SYNC] Template guardado exitosamente con SetUserTmpExStr
2025-06-19 14:02:46,662 [INFO] 🔄 [SYNC] Refrescando datos del dispositivo...
2025-06-19 14:02:46,699 [INFO] ✅ [SYNC] Datos del dispositivo refrescados
2025-06-19 14:02:46,700 [INFO] 🎉 [SYNC] === SINCRONIZACIÓN COMPLETADA EXITOSAMENTE ===
2025-06-19 14:02:46,703 [INFO] ℹ️ [WS] No hay más clientes, desconectando del F22...
2025-06-19 14:02:47,616 [INFO] 🔄 [EVENTS] Thread de monitoreo finalizado
2025-06-19 14:02:47,617 [INFO] 🔌 [DISCONNECT] Desconectando del F22...
2025-06-19 14:02:47,785 [INFO] ✅ [DISCONNECT] Desconectado de F22
2025-06-19 14:08:22,769 [INFO] server closing
2025-06-19 14:08:22,771 [INFO] server closed
2025-06-19 14:08:22,773 [INFO] ⛔ Servicio detenido por el usuario
2025-06-19 15:00:39,994 [INFO] ================================================================================
2025-06-19 15:00:39,994 [INFO] 🚀 SERVICIO UNIFICADO F22 - REGISTRO Y CONTROL DE ACCESO
2025-06-19 15:00:39,995 [INFO] ================================================================================
2025-06-19 15:00:39,995 [INFO] 📅 Versión: 3.1.0 FIXED - 2025-06-19 15:00:39.995245
2025-06-19 15:00:39,995 [INFO] 👤 Autor: luishdz04
2025-06-19 15:00:39,995 [INFO] 🌐 Puerto WebSocket: 8082
2025-06-19 15:00:39,995 [INFO] 🏢 Dispositivo: 192.168.1.201:4370
2025-06-19 15:00:39,995 [INFO] 🌍 Zona horaria: America/Mexico_City
2025-06-19 15:00:39,995 [INFO] 
2025-06-19 15:00:39,995 [INFO] ✅ CARACTERÍSTICAS:
2025-06-19 15:00:39,995 [INFO]    📝 Registro de huellas digitales
2025-06-19 15:00:39,995 [INFO]    🔐 Control de acceso en tiempo real
2025-06-19 15:00:39,995 [INFO]    📊 Validación de membresías activas
2025-06-19 15:00:39,995 [INFO]    ⏰ Restricciones de horarios
2025-06-19 15:00:39,995 [INFO]    🚪 Control automático de puertas
2025-06-19 15:00:39,995 [INFO]    💾 Registro completo en base de datos
2025-06-19 15:00:39,995 [INFO] 
2025-06-19 15:00:39,996 [INFO] 🔧 IMPLEMENTACIÓN CORREGIDA:
2025-06-19 15:00:39,996 [INFO]    ✅ Thread dedicado para eventos COM
2025-06-19 15:00:39,996 [INFO]    ✅ DispatchWithEvents para eventos COM
2025-06-19 15:00:39,996 [INFO]    ✅ Aislamiento correcto de threads COM
2025-06-19 15:00:39,996 [INFO]    ✅ Cola de eventos asíncrona
2025-06-19 15:00:39,996 [INFO]    ✅ Validación completa de accesos
2025-06-19 15:00:39,996 [INFO] ================================================================================
2025-06-19 15:00:40,007 [INFO] server listening on 127.0.0.1:8082
2025-06-19 15:00:40,008 [INFO] ✅ Servidor WebSocket activo en ws://127.0.0.1:8082
2025-06-19 15:00:40,008 [INFO] ⏳ Esperando conexiones...
2025-06-19 15:01:39,262 [INFO] connection open
2025-06-19 15:01:39,263 [INFO] 🔌 [WS] Cliente conectado: 2103488259680
2025-06-19 15:01:39,265 [INFO] 🎯 [MSG] Acción recibida: connect_device
2025-06-19 15:01:39,266 [INFO] 🔌 [CONNECT] Conectando a F22 en 192.168.1.201:4370...
2025-06-19 15:01:41,154 [INFO] HTTP Request: GET https://tyuuyqypgwvdtpfvumxx.supabase.co/rest/v1/access_control_config?select=%2A&limit=1 "HTTP/1.1 200 OK"
2025-06-19 15:01:41,156 [INFO] ✅ [CONFIG] Control de acceso: HABILITADO
2025-06-19 15:01:41,157 [INFO] ✅ [CONNECT] Conexión administrativa exitosa con F22
2025-06-19 15:01:41,189 [INFO] 🎯 [MSG] Acción recibida: sync_template_from_db
2025-06-19 15:01:41,189 [INFO] 🔄 [MSG] Iniciando sync_template_from_db para usuario 7265
2025-06-19 15:01:41,190 [INFO] 🔄 [SYNC] Iniciando sincronización de template desde BD...
2025-06-19 15:01:41,190 [INFO] 🔍 [SYNC] Consultando nombre para usuario UUID: 67378a76-78dc-49d9-9864-83aef6754961
2025-06-19 15:01:41,190 [INFO] 🔍 [SUPABASE] Consultando usuario: 67378a76-78dc-49d9-9864-83aef6754961
2025-06-19 15:01:42,224 [INFO] HTTP Request: GET https://tyuuyqypgwvdtpfvumxx.supabase.co/rest/v1/Users?select=firstName%2ClastName&id=eq.67378a76-78dc-49d9-9864-83aef6754961 "HTTP/1.1 200 OK"
2025-06-19 15:01:42,226 [INFO] ✅ [SUPABASE] Nombre obtenido: 'MUP - Erick Francisco De Luna'
2025-06-19 15:01:42,227 [INFO] 🔄 [SYNC] === DATOS DE SINCRONIZACIÓN ===
2025-06-19 15:01:42,227 [INFO] 👤 [SYNC] Usuario: 7265 - 'MUP - Erick Francisco De Luna'
2025-06-19 15:01:42,228 [INFO] 🖐️ [SYNC] Dedo: Frontend 8 → ZKTeco 7 (Medio Izquierdo)
2025-06-19 15:01:42,274 [INFO] 👤 [SYNC] Configurando usuario en F22...
2025-06-19 15:01:42,555 [INFO] ✅ [SYNC] Usuario configurado en F22: MUP - Erick Francisco De Luna
2025-06-19 15:01:42,556 [INFO] 🖐️ [SYNC] Guardando template de huella en F22...
2025-06-19 15:01:42,556 [INFO] 🔧 [SYNC] Método 1: SetUserTmpExStr...
2025-06-19 15:01:42,940 [INFO] ✅ [SYNC] Template guardado exitosamente con SetUserTmpExStr
2025-06-19 15:01:42,990 [INFO] 🔄 [SYNC] Refrescando datos del dispositivo...
2025-06-19 15:01:43,042 [INFO] ✅ [SYNC] Datos del dispositivo refrescados
2025-06-19 15:01:43,042 [INFO] 🎉 [SYNC] === SINCRONIZACIÓN COMPLETADA EXITOSAMENTE ===
2025-06-19 15:01:43,047 [INFO] ℹ️ [WS] No hay más clientes, programando desconexión...
2025-06-19 15:02:13,049 [INFO] ℹ️ [AUTO] Desconectando por inactividad (30s)...
2025-06-19 15:02:13,050 [INFO] 🔄 [MONITOR] Deteniendo monitoreo...
2025-06-19 15:02:13,050 [INFO] ✅ [MONITOR] Monitoreo detenido
2025-06-19 15:02:13,050 [INFO] 🔌 [DISCONNECT] Desconectando conexión administrativa...
2025-06-19 15:02:13,218 [INFO] ✅ [DISCONNECT] Desconectado de F22
2025-06-19 15:08:15,955 [INFO] server closing
2025-06-19 15:08:15,955 [INFO] server closed
2025-06-19 15:08:15,957 [INFO] ⛔ Servicio detenido por el usuario
